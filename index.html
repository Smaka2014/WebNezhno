<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ö–∞—Ç–∞–ª–æ–≥ Nezhno</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root {
      --bg: #0e1117;
      --card-bg: #161b22;
      --accent: #ffb6c9;
      --accent-soft: rgba(255, 182, 201, 0.12);
      --text: #ffffff;
      --text-muted: #9ca3af;
      --border: #262b36;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.45);
      --accent-gradient: linear-gradient(135deg, #ffb6c9, #ff8fb3);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding-bottom: 60px; /* —á—Ç–æ–±—ã —Ñ—É—Ç–µ—Ä —Å –±–æ—Ç–æ–º –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª –∫–æ–Ω—Ç–µ–Ω—Ç */
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", sans-serif;
      background: radial-gradient(circle at top, #1b2233 0%, #05060a 50%, #050509 100%);
      color: var(--text);
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 12px 12px 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* ---------- HEADER ---------- */

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(9, 11, 18, 0.95);
      border: 1px solid rgba(255, 182, 201, 0.16);
      box-shadow: 0 14px 45px rgba(0, 0, 0, 0.55);
      position: sticky;
      top: 6px;
      z-index: 5;
      backdrop-filter: blur(22px);
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .app-title {
      font-weight: 700;
      font-size: 17px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .app-title span.logo {
      display: inline-flex;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--accent-gradient);
      align-items: center;
      justify-content: center;
      font-size: 13px;
      box-shadow: 0 0 0 2px rgba(8, 12, 22, 0.8);
    }

    .app-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .header-right {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .icon-btn {
      border: none;
      outline: none;
      padding: 8px 9px;
      border-radius: 999px;
      background: rgba(19, 24, 33, 0.9);
      color: var(--text);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.12s ease, background 0.18s ease;
      border: 1px solid rgba(255, 255, 255, 0.03);
    }

    .icon-btn span.label {
      font-size: 12px;
      margin-left: 5px;
      color: var(--text-muted);
    }

    .icon-btn.highlight {
      background: var(--accent-soft);
      border-color: rgba(255, 182, 201, 0.4);
      color: var(--accent);
    }

    .icon-btn:active {
      transform: scale(0.96);
    }

    /* ---------- SEARCH ---------- */

    .search-wrapper {
      margin: 4px 2px 2px;
    }

    .search-bar {
      display: flex;
    }

    .search-bar input {
      width: 100%;
      padding: 7px 12px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.9);
      color: #fff;
      font-size: 13px;
      outline: none;
    }

    .search-bar input::placeholder {
      color: var(--text-muted);
    }

    /* ---------- PRODUCT GRID ---------- */

    .catalog-title {
      margin: 4px 2px 6px;
      font-size: 15px;
      font-weight: 600;
      color: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .catalog-title span.muted {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 400;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      padding-bottom: 6px;
    }

    .product-card {
      background: radial-gradient(circle at top left, #25293a 0%, #111320 55%, #05060b 100%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 9px;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 13px 30px rgba(0, 0, 0, 0.55);
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
        border-color 0.18s ease-out, background 0.18s ease-out;
    }

    .product-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0 0,
          rgba(255, 182, 201, 0.16),
          transparent 55%);
      opacity: 0;
      transition: opacity 0.25s ease-out;
      pointer-events: none;
    }

    .product-card:active {
      transform: scale(0.97) translateY(1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.65);
      border-color: rgba(255, 182, 201, 0.4);
    }

    .product-card:active::before {
      opacity: 1;
    }

    .product-thumb {
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      aspect-ratio: 4 / 3;
      margin-bottom: 7px;
      background: radial-gradient(circle at top, #3b3141, #141220);
    }

    .product-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.35s ease-out;
    }

    .product-card:hover .product-thumb img {
      transform: scale(1.02);
    }

    .product-tag {
      position: absolute;
      left: 7px;
      top: 7px;
      padding: 3px 7px;
      font-size: 11px;
      border-radius: 999px;
      background: rgba(5, 7, 13, 0.82);
      color: var(--accent);
      border: 1px solid rgba(255, 182, 201, 0.65);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      backdrop-filter: blur(16px);
    }

    .product-tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-gradient);
    }

    .product-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-top: 1px;
    }

    .product-title {
      font-size: 13px;
      font-weight: 600;
      color: #f9fafb;
    }

    .product-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    .product-footer {
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .product-price {
      font-size: 13px;
      font-weight: 600;
      color: var(--accent);
    }

    .product-chip {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-muted);
    }

    /* ---------- MODAL OVERLAY (PRODUCT) ---------- */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(5, 7, 15, 0.78);
      backdrop-filter: blur(18px);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 50;
    }

    .modal-backdrop.open {
      display: flex;
      animation: fadeIn 0.18s ease-out forwards;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal-sheet {
      width: 100%;
      max-width: 480px;
      border-radius: 18px 18px 0 0;
      background: radial-gradient(circle at top, #1f2437 0%, #05060b 55%, #030308 100%);
      border-top: 1px solid rgba(148, 163, 184, 0.4);
      border-left: 1px solid rgba(15, 23, 42, 0.9);
      border-right: 1px solid rgba(15, 23, 42, 0.9);
      box-shadow: 0 -24px 60px rgba(0, 0, 0, 0.85);
      padding: 10px 12px 16px;
      max-height: 92vh;
      display: flex;
      flex-direction: column;
      animation: slideUp 0.22s ease-out;
    }

    @keyframes slideUp {
      from {
        transform: translateY(14px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .sheet-grabber {
      width: 46px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.45);
      margin: 0 auto 8px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .modal-title-box {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .modal-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .close-btn {
      border: none;
      outline: none;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      width: 30px;
      height: 30px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      cursor: pointer;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 17px;
      flex-shrink: 0;
    }

    .close-btn:active {
      transform: scale(0.94);
    }

    /* ---------- GALLERY ---------- */

    .modal-content {
      overflow-y: auto;
      padding-right: 2px;
      padding-bottom: 4px;
    }

    .gallery {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      margin-bottom: 10px;
      background: radial-gradient(circle at top, #3b3141, #141220);
    }

    .gallery-track {
      display: flex;
      transition: transform 0.25s ease-out;
      will-change: transform;
    }

    .gallery-slide {
      min-width: 100%;
      user-select: none;
    }

    .gallery-slide img {
      width: 100%;
      height: 240px;
      object-fit: cover;
      display: block;
    }

    .gallery-dots {
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 5px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(5, 7, 13, 0.78);
      backdrop-filter: blur(16px);
    }

    .gallery-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.6);
      transition: width 0.18s ease, background 0.18s ease;
    }

    .gallery-dot.active {
      width: 12px;
      background: var(--accent-gradient);
    }

    .gallery-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.82);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 18px;
      backdrop-filter: blur(12px);
    }

    .gallery-arrow.left {
      left: 8px;
    }

    .gallery-arrow.right {
      right: 8px;
    }

    .gallery-arrow:active {
      transform: translateY(-50%) scale(0.92);
    }

    /* ---------- DESCRIPTION & INFO ---------- */

    .product-description {
      font-size: 13px;
      color: #e5e7eb;
      line-height: 1.45;
      margin-bottom: 10px;
    }

    .product-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
    }

    .badge.accent {
      border-color: rgba(255, 182, 201, 0.7);
      color: var(--accent);
      background: rgba(255, 182, 201, 0.12);
    }

    .product-detail-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .product-detail-label {
      color: var(--text-muted);
    }

    .product-detail-value {
      font-weight: 500;
    }

    .modal-footer {
      margin-top: 6px;
      padding-top: 8px;
      border-top: 1px dashed rgba(55, 65, 81, 0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .modal-price {
      font-size: 16px;
      font-weight: 600;
      color: var(--accent);
    }

    .modal-price-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    .primary-btn {
      flex: 1;
      border: none;
      outline: none;
      padding: 9px 14px;
      border-radius: 999px;
      background: var(--accent-gradient);
      color: #111827;
      font-size: 14px;
      font-weight: 600;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(255, 182, 201, 0.45);
    }

    .primary-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 16px rgba(255, 182, 201, 0.35);
    }

    /* ---------- BOTTOM SYSTEM TEXT ---------- */

    .system-note {
      margin-top: auto;
      font-size: 11px;
      color: var(--text-muted);
      padding: 8px 10px 2px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    /* ---------- CART MODAL ---------- */

    /* –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É" ‚Äî –æ–≤–∞–ª—å–Ω–∞—è, —Ä–æ–∑–æ–≤–∞—Ç–∞—è, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ —Å–Ω–∏–∑—É */
    .go-to-cart-btn {
      display: none;
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 70px;
      padding: 12px 26px;
      border-radius: 999px;
      border: 1px solid rgba(255, 182, 201, 0.55);
      background: rgba(255, 182, 201, 0.16);
      color: #ffb6c9;
      font-size: 0.96rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.55);
      cursor: pointer;
    }

    .go-to-cart-btn.active {
      display: block;
    }

    .go-to-cart-btn:active {
      transform: translateX(-50%) scale(0.97);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.7);
    }

    .cart-modal {
      display: none;
      position: fixed;
      top: 60px;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(20, 25, 30, 0.97);
      z-index: 35;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 80px;
    }

    .cart-modal.active {
      display: flex;
    }

    .cart-content {
      background: #232d36;
      border-radius: 18px;
      padding: 28px 24px;
      min-width: 300px;
      text-align: center;
      max-width: 90vw;
    }

    .cart-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 16px;
    }

    .cart-list {
      margin-bottom: 18px;
      max-height: 260px;
      overflow-y: auto;
      text-align: left;
      font-size: 0.95rem;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      color: #fff;
      gap: 8px;
    }

    .cart-item-left {
      flex: 1;
    }

    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .qty-btn {
      background: #2e3640;
      color: #fff;
      border: none;
      width: 26px;
      height: 26px;
      border-radius: 6px;
      cursor: pointer;
    }

    .qty-text {
      min-width: 20px;
      text-align: center;
    }

    .cart-empty {
      color: #aaa;
      text-align: center;
    }

    .cart-total {
      margin-top: 10px;
      font-weight: 600;
      text-align: right;
    }

    .close-cart {
      background: #2e3640;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 7px 16px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 6px;
      width: 100%;
    }

    .cart-promo {
      margin-top: 10px;
      display: flex;
      gap: 8px;
    }
    .promo-input {
      flex: 1;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: #fff;
      font-size: 0.95rem;
    }
    .promo-input::placeholder {
      color: #6b7280;
    }
    .promo-apply-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255, 182, 201, 0.55);
      background: rgba(255, 182, 201, 0.12);
      color: #ffb6c9;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
    }
    .promo-apply-btn:active {
      transform: scale(0.96);
    }
    .promo-message {
      margin-top: 6px;
      font-size: 0.85rem;
      text-align: left;
      color: #9ca3af;
    }
    /* —Å—Ç—Ä–æ–∫–∏ —Å —Å—É–º–º–∞–º–∏ */
    .cart-total {
      margin-top: 14px;
      text-align: right;
      font-size: 0.95rem;
    }
    .cart-total-line {
      margin-bottom: 4px;
    } 
    .cart-total-discount {
      color: #f97373;
    }
    .cart-total-final {
      font-weight: 700;
      color: #ffb6c9;
    }

    .checkout-btn {
      margin-top: 12px;
      width: 100%;
      padding: 11px 18px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ffb6c9, #ff8fb3);
      color: #111827;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      cursor: pointer;
      box-shadow: 0 12px 32px rgba(255, 182, 201, 0.45);
    }

    .checkout-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 18px rgba(255, 182, 201, 0.35);
    }

    /* ---------- PROFILE MODAL ---------- */

    .profile-modal {
      display: none;
      position: fixed;
      top: 60px;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(20, 25, 30, 0.97);
      z-index: 40;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 60px;
    }

    .profile-modal.active {
      display: flex;
    }

    .profile-content {
      background: #232d36;
      border-radius: 18px;
      padding: 32px 26px;
      min-width: 310px;
      max-width: 92vw;
      text-align: left;
    }

    .profile-title {
      font-size: 1.23rem;
      font-weight: bold;
      margin-bottom: 18px;
      text-align: center;
    }

    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .profile-form input,
    .profile-form select {
      box-sizing: border-box;
      background: #182027;
      color: #fff;
      border: 1.3px solid #313e4a;
      border-radius: 7px;
      padding: 10px 12px;
      font-size: 1rem;
      width: 100%;
    }

    .save-profile-btn,
    .close-profile-btn {
      margin-top: 10px;
      background: #4151fc;
      color: #fff;
      border-radius: 8px;
      padding: 9px 0;
      font-size: 1rem;
      border: none;
      cursor: pointer;
      width: 100%;
    }

    .close-profile-btn {
      background: #2e3640;
      margin-top: 5px;
    }

    /* ---------- FOOTER BOT LINK ---------- */

    .bot-link {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      text-align: center;
      padding: 14px;
      background: #1b232b;
      color: #6acecb;
      border-top: 1px solid #293038;
      font-size: 0.93rem;
      letter-spacing: 0.03em;
      z-index: 45;
    }

    .bot-link a {
      color: #6acecb;
      text-decoration: none;
    }

    .bot-link a:hover {
      text-decoration: underline;
    }

    /* ---------- CONFIRM MODAL ---------- */

    .confirm-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .confirm-backdrop.active {
      display: flex;
    }

    .confirm-modal {
      background: #232d36;
      border-radius: 16px;
      padding: 20px 18px;
      max-width: 320px;
      width: 90%;
      box-shadow: 0 4px 24px #00000080;
      text-align: left;
      font-size: 0.98rem;
      color: #e5e7eb;
    }

    .confirm-text {
      margin-bottom: 16px;
      line-height: 1.4;
    }

    .confirm-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .btn {
      padding: 7px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 0.98rem;
      font-weight: 500;
    }

    .btn-secondary {
      background: #2e3640;
      color: #fff;
    }

    .btn-primary {
      background: #4151fc;
      color: #fff;
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- HEADER -->
    <header class="header">
      <div class="header-left">
        <div class="app-title">
          <span class="logo">N</span>
          –ö–∞—Ç–∞–ª–æ–≥ Nezhno
        </div>
        <div class="app-subtitle">@nezhnomasterskayabot</div>
      </div>
      <div class="header-right">
        <button class="icon-btn" type="button" id="profileBtn">
          üë§ <span class="label">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
        <button class="icon-btn highlight" type="button" id="cartButton">
          üõí <span class="label">–ö–æ—Ä–∑–∏–Ω–∞ (0)</span>
        </button>
      </div>
    </header>

    <!-- SEARCH -->
    <div class="search-wrapper">
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É..." />
      </div>
    </div>

    <!-- CATALOG TITLE -->
    <div class="catalog-title">
      <span>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∑–∏—Ü–∏—é</span>
      <span class="muted">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–æ–≤–∞—Ä, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</span>
    </div>

    <!-- GRID –î–õ–Ø –¢–û–í–ê–†–û–í -->
    <div class="products-grid" id="productsGrid"></div>

    <!-- –°–ò–°–¢–ï–ú–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï -->
    <div class="system-note">
      –°–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
      –∑–∞–∫–∞–∑–∞ –≤ —á–∞—Ç–µ Telegram. –ü–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
      –∏ —Å—Ä–æ–∫–∏ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è.
    </div>
  </div>

  <!-- MODAL SHEET (PRODUCT DETAILS) -->
  <div class="modal-backdrop" id="productModal">
    <div class="modal-sheet">
      <div class="sheet-grabber"></div>

      <div class="modal-header">
        <div class="modal-title-box">
          <div class="modal-title" id="modalTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</div>
          <div class="modal-subtitle" id="modalSubtitle">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</div>
        </div>
        <button class="close-btn" type="button" id="closeModalBtn">&times;</button>
      </div>

      <div class="modal-content">
        <!-- –ì–∞–ª–µ—Ä–µ—è -->
        <div class="gallery" id="gallery">
          <div class="gallery-track" id="galleryTrack"></div>
          <div class="gallery-dots" id="galleryDots"></div>
          <button class="gallery-arrow left" type="button" id="arrowLeft">&#x276E;</button>
          <button class="gallery-arrow right" type="button" id="arrowRight">&#x276F;</button>
        </div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div class="product-description" id="modalDescription">
          –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞. –¢—ã –º–æ–∂–µ—à—å —É–∫–∞–∑–∞—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Ä–∞–∑–º–µ—Ä—ã,
          –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –¥–µ—Ç–∞–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.
        </div>

        <div class="product-badges" id="modalBadges">
          <!-- –ë–µ–π–¥–∂–∏ -->
        </div>

        <div class="product-detail-row">
          <span class="product-detail-label">–°—Ä–æ–∫ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</span>
          <span class="product-detail-value" id="modalLeadTime">‚Äî</span>
        </div>
        <div class="product-detail-row">
          <span class="product-detail-label">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞</span>
          <span class="product-detail-value" id="modalPrepay">‚Äî</span>
        </div>
      </div>

      <!-- –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
      <div class="modal-footer">
        <div>
          <div class="modal-price" id="modalPrice">0 ‚ÇΩ</div>
          <div class="modal-price-label">–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
        </div>
        <button class="primary-btn" type="button" id="addToCartBtn">
          –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
        </button>
      </div>
    </div>
  </div>

  <!-- –ö–ù–û–ü–ö–ê "–ü–ï–†–ï–ô–¢–ò –í –ö–û–†–ó–ò–ù–£" -->
  <button class="go-to-cart-btn" id="goToCartBtn">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</button>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ö–û–†–ó–ò–ù–´ -->
  <div class="cart-modal" id="cartModal">
    <div class="cart-content">
      <div class="cart-title">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</div>
      <div class="cart-list" id="cartList"></div>
      <!-- –ü–†–û–ú–û–ö–û–î -->
      <div class="cart-promo">
        <input
          type="text"
          id="promoInput"
          class="promo-input"
          placeholder="–ü—Ä–æ–º–æ–∫–æ–¥"
        />
        <button type="button" id="applyPromoBtn" class="promo-apply-btn">
          –ü—Ä–∏–º–µ–Ω–∏—Ç—å
        </button>
      </div>
      <div class="promo-message" id="promoMessage"></div>
      <!-- –ò–¢–û–ì–ò -->
      <div class="cart-total" id="cartTotal"></div>
      <!-- –ö–ù–û–ü–ö–ò -->
      <button class="checkout-btn" id="checkoutBtn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      <button class="close-cart" id="closeCartBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–†–û–§–ò–õ–Ø -->
  <div class="profile-modal" id="profileModal">
    <div class="profile-content">
      <div class="profile-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</div>
      <form class="profile-form" id="profileForm">
        <input type="text" id="surname" name="surname" placeholder="–§–∞–º–∏–ª–∏—è">
        <input type="text" id="name" name="name" placeholder="–ò–º—è">
        <input type="text" id="patronymic" name="patronymic" placeholder="–û—Ç—á–µ—Å—Ç–≤–æ">
        <input type="email" id="email" name="email" placeholder="–ü–æ—á—Ç–∞">
        <select id="country" name="country">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
          <option value="–†–æ—Å—Å–∏—è">–†–æ—Å—Å–∏—è</option>
          <option value="–ë–µ–ª–∞—Ä—É—Å—å">–ë–µ–ª–∞—Ä—É—Å—å</option>
          <option value="–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω">–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</option>
        </select>
        <select id="region" name="region">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</option>
          <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
          <option value="–°–ü–±">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
        </select>
        <select id="city" name="city">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥/–ø–æ—Å—ë–ª–æ–∫</option>
          <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
          <option value="–ü–µ—Ç–µ—Ä–±—É—Ä–≥">–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
        </select>
        <button type="submit" class="save-profile-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" class="close-profile-btn" id="closeProfileBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </form>
    </div>
  </div>

  <!-- –§–£–¢–ï–†-–°–°–´–õ–ö–ê –ù–ê –ë–û–¢–ê -->
  <div class="bot-link">
    <a href="https://t.me/nezhnomasterskayabot" target="_blank">@nezhnomasterskayabot</a>
  </div>

  <!-- –ú–û–î–ê–õ–ö–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –û–¢–ü–†–ê–í–ö–ò –ó–ê–ö–ê–ó–ê -->
  <div class="confirm-backdrop" id="confirmBackdrop">
    <div class="confirm-modal">
      <div class="confirm-text">
        –î–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?
      </div>
      <div class="confirm-buttons">
        <button class="btn btn-secondary" id="confirmCancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" id="confirmOk">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    if (tg) tg.expand();

    // ====== –î–ê–ù–ù–´–ï –û –¢–û–í–ê–†–ê–• (–æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –∏–∑ –æ–±–æ–∏—Ö —Ñ–∞–π–ª–æ–≤) ======
    const products = [
      {
        id: 'bracelet-rose',
        name: '–ë—Ä–∞—Å–ª–µ—Ç ¬´–ù–µ–∂–Ω–∞—è —Ä–æ–∑–∞¬ª',
        short: '–î–µ–ª–∏–∫–∞—Ç–Ω—ã–π –±—Ä–∞—Å–ª–µ—Ç —Å –∞–∫—Ü–µ–Ω—Ç–Ω–æ–π —Ä–æ–∑–æ–π',
        description:
          '–õ—ë–≥–∫–∏–π –±—Ä–∞—Å–ª–µ—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –ª—é–±–∏—Ç –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ, –Ω–æ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–µ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã. –í—ã–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é, –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏ –º—è–≥–∫–∏–µ –æ—Ç—Ç–µ–Ω–∫–∏ –¥–µ–ª–∞—é—Ç –µ–≥–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫ –ª—é–±–æ–º—É –æ–±—Ä–∞–∑—É.',
        price: 2500,
        leadTime: '3‚Äì5 –¥–Ω–µ–π',
        prepay: '30%',
        tag: '–•–∏—Ç',
        chip: '–í –Ω–∞–ª–∏—á–∏–∏',
        badges: ['–†—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞', '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä', '–ì–∏–ø–æ–∞–ª–ª–µ—Ä–≥–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã'],
        images: [
          'https://via.placeholder.com/600x400?text=Bracelet+1',
          'https://via.placeholder.com/600x400?text=Bracelet+2',
          'https://via.placeholder.com/600x400?text=Bracelet+3'
        ]
      },
      {
        id: 'base-candle1',
        name: '–°–≤–µ—á–∫–∞ –±–∞–∑–æ–≤–∞—è 250–º–ª',
        short: 'Sleepyhead (–∫–æ—Ñ–µ, –æ–±–∂–∞—Ä–µ–Ω–Ω—ã–µ –∫–æ—Ñ–µ–π–Ω—ã–µ –∑—ë—Ä–Ω–∞, –≤–∞–Ω–∏–ª—å, –≥–≤–∞—è–∫–æ–≤–æ–µ –¥–µ—Ä–µ–≤–æ)',
        description:
          '–°–≤–µ—á–∞ –≤ –º–∞—Ç–æ–≤–æ–º —Å—Ç–µ–∫–ª–µ/–º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–æ–π –±–∞–Ω–æ—á–∫–µ —Å –∞—Ä–æ–º–∞—Ç–æ–º —Å–ª–∞–¥–∫–æ–≥–æ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–æ—Ñ–µ, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è –ø–æ —É—Ç—Ä–∞–º. –£–ø–∞–∫–æ–≤–∞–Ω–∞ –≤ –±—É–º–∞–≥—É —Ç–∏—à—å—é –∏ –±—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞–∫–µ—Ç –º–∏–Ω–∏, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è.',
        price: 2290,
        leadTime: '2-3 –¥–Ω—è',
        prepay: '',
        tag: '–ù–æ–≤–∏–Ω–∫–∞',
        chip: '–ù–∞ –∑–∞–∫–∞–∑',
        badges: [],
        images: [
          'https://github.com/Smaka2014/WebNezhno/blob/main/IMG_0122.PNG',
          'https://github.com/Smaka2014/WebNezhno/blob/main/IMG_0124.PNG'
        ]
      },
      {
        id: 'base-candle2',
        name: '–°–≤–µ—á–∫–∞ –±–∞–∑–æ–≤–∞—è 250–º–ª',
        short: 'Cinemaholic (–±—É—Ä–±–æ–Ω—Å–∫–∞—è –≤–∞–Ω–∏–ª—å, –∫–æ—Ñ–µ, –∫–∞—Ä–∞–º–µ–ª—å–Ω—ã–π –ø–æ–ø–∫–æ—Ä–Ω, —Ä–æ–º, –∫–ª–µ–Ω–æ–≤—ã–π —Å–∏—Ä–æ–ø)',
        description: '–°–≤–µ—á–∞ –≤ –º–∞—Ç–æ–≤–æ–º —Å—Ç–µ–∫–ª–µ/–º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–æ–π –±–∞–Ω–æ—á–∫–µ —Å —è—Ä–∫–∏–º –∏ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–º –∞—Ä–æ–º–∞—Ç–æ–º –∫–∞—Ä–∞–º–µ–ª—å–Ω–æ–≥–æ –ø–æ–ø–∫–æ—Ä–Ω–∞, –ø—Ä—è–º–æ –∫–∞–∫ –≤ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–µ. –£–ø–∞–∫–æ–≤–∞–Ω–∞ –≤ –±—É–º–∞–≥—É —Ç–∏—à—å—é –∏ –±—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞–∫–µ—Ç –º–∏–Ω–∏, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è.',
        price: 2290,
        leadTime: '',
        prepay: '',
        tag: '',
        chip: '',
        badges: [],
        images: [
          'https://static.insales.ru/images/collections/1/5375/391322351/medium_B_Complex.jpg'
        ]
      },
      {
        id: '2',
        name: '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –Ω–∞–±–æ—Ä',
        short: '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –Ω–∞–±–æ—Ä',
        description: '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –Ω–∞–±–æ—Ä',
        price: 3390,
        leadTime: '',
        prepay: '',
        tag: '',
        chip: '',
        badges: [],
        images: [
          'https://static.insales.ru/images/collections/1/5375/391323985/medium_BPC-157.jpg'
        ]
      },
      {
        id: '3',
        name: '–°–≤–µ—á–∫–∞ 100–º–ª',
        short: '–°–≤–µ—á–∫–∞ 100–º–ª',
        description: '–°–≤–µ—á–∫–∞ 100–º–ª',
        price: 1790,
        leadTime: '',
        prepay: '',
        tag: '',
        chip: '',
        badges: [],
        images: [
          'https://static.insales.ru/images/collections/1/5375/391324194/medium_SJ-PP-332.jpg'
        ]
      }
    ];

    // ===== –ü–†–û–ú–û–ö–û–î–´ =====
    // –ó–¥–µ—Å—å —É–∫–∞–∂–∏ –°–í–û–ò –ø—Ä–æ–º–æ–∫–æ–¥—ã –∏ —Ä–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏.
    // –∫–ª—é—á ‚Äî –ø—Ä–æ–º–æ–∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞), –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –¥–æ–ª—è —Å–∫–∏–¥–∫–∏ (0.1 = 10%, 0.2 = 20% –∏ —Ç.–¥.)
    const PROMO_CODES = {
      'NEZHNO': 0.10,
      // 'LOVE10': 0.10,
      // 'SPRING15': 0.15,
    };
    // –¢–µ–∫—É—â–∏–π –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ (–∏–ª–∏ null, –µ—Å–ª–∏ –Ω–µ—Ç)
    let appliedPromo = null;
    
    function formatPrice(value) {
      if (value == null) return '';
      return value.toLocaleString('ru-RU') + ' ‚ÇΩ';
    }

    // ====== DOM-–°–°–´–õ–ö–ò ======
    const productsGrid = document.getElementById('productsGrid');
    const searchInput = document.getElementById('searchInput');

    const modalBackdrop = document.getElementById('productModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const modalTitle = document.getElementById('modalTitle');
    const modalSubtitle = document.getElementById('modalSubtitle');
    const modalDescription = document.getElementById('modalDescription');
    const modalPrice = document.getElementById('modalPrice');
    const modalLeadTime = document.getElementById('modalLeadTime');
    const modalPrepay = document.getElementById('modalPrepay');
    const modalBadges = document.getElementById('modalBadges');

    const gallery = document.getElementById('gallery');
    const galleryTrack = document.getElementById('galleryTrack');
    const galleryDots = document.getElementById('galleryDots');
    const arrowLeft = document.getElementById('arrowLeft');
    const arrowRight = document.getElementById('arrowRight');

    const addToCartBtn = document.getElementById('addToCartBtn');
    const cartButton = document.getElementById('cartButton');
    const cartBtn = document.getElementById('cartBtn');
    const cartCount = document.getElementById('cartCount');
    const cartModal = document.getElementById('cartModal');
    const cartList = document.getElementById('cartList');
    const cartTotalEl = document.getElementById('cartTotal');
    const closeCartBtn = document.getElementById('closeCartBtn');
    const goToCartBtn = document.getElementById('goToCartBtn');
    const checkoutBtn = document.getElementById('checkoutBtn');
    // —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
    const promoInput = document.getElementById('promoInput');
    const applyPromoBtn = document.getElementById('applyPromoBtn');
    const promoMessage = document.getElementById('promoMessage');
    const cartLabel = cartButton ? cartButton.querySelector('.label') : null;


    const profileBtn = document.getElementById('profileBtn');
    const profileModal = document.getElementById('profileModal');
    const closeProfileBtn = document.getElementById('closeProfileBtn');
    const profileForm = document.getElementById('profileForm');

    const confirmBackdrop = document.getElementById('confirmBackdrop');
    const confirmCancel = document.getElementById('confirmCancel');
    const confirmOk = document.getElementById('confirmOk');

    // ====== –°–û–°–¢–û–Ø–ù–ò–ï ======
    let currentProduct = null;
    let currentSlide = 0;
    let totalSlides = 0;

    let cart = [];

    function getCartItem(id) {
      return cart.find(item => item.id === id);
    }

    // ====== –†–ï–ù–î–ï–† –ö–ê–¢–ê–õ–û–ì–ê ======
    function renderProducts(list) {
      if (!productsGrid) return;
      productsGrid.innerHTML = '';

      list.forEach(product => {
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'product-card';
        card.dataset.id = product.id;

        const priceText = formatPrice(product.price);

        card.innerHTML = `
          <div class="product-thumb">
            <img src="${(product.images && product.images[0]) || ''}" alt="${product.name || ''}" loading="lazy" />
            ${product.tag
              ? `<div class="product-tag">
                   <span class="product-tag-dot"></span>${product.tag}
                 </div>`
              : ''
            }
          </div>
          <div class="product-info">
            <div class="product-title">${product.name || ''}</div>
            <div class="product-meta">${product.short || ''}</div>
            <div class="product-footer">
              <div class="product-price">${priceText}</div>
              ${product.chip ? `<div class="product-chip">${product.chip}</div>` : ''}
            </div>
          </div>
        `;

        card.addEventListener('click', () => openProductModal(product.id));
        productsGrid.appendChild(card);
      });
    }

    // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
    renderProducts(products);

    // –ü–û–ò–°–ö
    if (searchInput) {
      searchInput.addEventListener('input', () => {
        const value = searchInput.value.toLowerCase();
        const filtered = products.filter(p =>
          (p.name && p.name.toLowerCase().includes(value)) ||
          (p.short && p.short.toLowerCase().includes(value))
        );
        renderProducts(filtered);
      });
    }

    // ====== –ú–û–î–ê–õ–ö–ê –¢–û–í–ê–†–ê –ò –ì–ê–õ–ï–†–ï–Ø ======
    function openProductModal(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      currentProduct = product;
      currentSlide = 0;

      modalTitle.textContent = product.name || '';
      modalSubtitle.textContent = product.short || '';
      modalDescription.textContent = product.description || '';
      modalPrice.textContent = formatPrice(product.price) || '';
      modalLeadTime.textContent = product.leadTime || '‚Äî';
      modalPrepay.textContent = product.prepay || '‚Äî';

      modalBadges.innerHTML = '';
      if (Array.isArray(product.badges)) {
        product.badges.forEach((b, idx) => {
          const span = document.createElement('span');
          span.className = 'badge' + (idx === 0 ? ' accent' : '');
          span.textContent = b;
          modalBadges.appendChild(span);
        });
      }

      buildGallery(product.images || []);

      modalBackdrop.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeProductModal() {
      modalBackdrop.classList.remove('open');
      document.body.style.overflow = '';
      currentProduct = null;
    }

    if (closeModalBtn) {
      closeModalBtn.addEventListener('click', closeProductModal);
    }

    if (modalBackdrop) {
      modalBackdrop.addEventListener('click', (e) => {
        if (e.target === modalBackdrop) {
          closeProductModal();
        }
      });
    }

    function buildGallery(images) {
      galleryTrack.innerHTML = '';
      galleryDots.innerHTML = '';

      if (!images.length) {
        gallery.style.display = 'none';
        return;
      }
      gallery.style.display = 'block';

      images.forEach((src, index) => {
        const slide = document.createElement('div');
        slide.className = 'gallery-slide';
        slide.innerHTML = `<img src="${src}" alt="${currentProduct?.name || '–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞'}" />`;
        galleryTrack.appendChild(slide);

        const dot = document.createElement('div');
        dot.className = 'gallery-dot' + (index === 0 ? ' active' : '');
        dot.dataset.index = index;
        dot.addEventListener('click', () => goToSlide(index));
        galleryDots.appendChild(dot);
      });

      totalSlides = images.length;
      updateGallery();
    }

    function updateGallery() {
      const offset = -currentSlide * 100;
      galleryTrack.style.transform = `translateX(${offset}%)`;

      [...galleryDots.children].forEach((dot, index) => {
        dot.classList.toggle('active', index === currentSlide);
      });

      arrowLeft.style.visibility = currentSlide === 0 ? 'hidden' : 'visible';
      arrowRight.style.visibility = currentSlide === totalSlides - 1 ? 'hidden' : 'visible';
    }

    function goToSlide(index) {
      if (index < 0 || index >= totalSlides) return;
      currentSlide = index;
      updateGallery();
    }

    if (arrowLeft) {
      arrowLeft.addEventListener('click', () => goToSlide(currentSlide - 1));
    }
    if (arrowRight) {
      arrowRight.addEventListener('click', () => goToSlide(currentSlide + 1));
    }

    // –°–≤–∞–π–ø—ã
    let startX = 0;
    let isDragging = false;

    if (gallery) {
      gallery.addEventListener('touchstart', (e) => {
        if (!totalSlides) return;
        isDragging = true;
        startX = e.touches[0].clientX;
      });

      gallery.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        const dx = e.touches[0].clientX - startX;
        const threshold = 40;
        if (dx > threshold) {
          isDragging = false;
          goToSlide(currentSlide - 1);
        } else if (dx < -threshold) {
          isDragging = false;
          goToSlide(currentSlide + 1);
        }
      });

      gallery.addEventListener('touchend', () => {
        isDragging = false;
      });
    }

    // ====== –ö–û–†–ó–ò–ù–ê ======
    function updateCartUI() {
      const totalQty = cart.reduce((a, b) => a + b.qty, 0);
      if (cartLabel) {
        cartLabel.textContent = `–ö–æ—Ä–∑–∏–Ω–∞ (${totalQty})`;
      }
      if (goToCartBtn) {
        if (totalQty > 0) goToCartBtn.classList.add('active');
        else goToCartBtn.classList.remove('active');
      }
    }

    function addToCart(id) {
      const product = products.find(p => p.id === id);
      if (!product || product.price == null) return;

      const found = getCartItem(id);
      if (found) found.qty += 1;
      else cart.push({ id: product.id, name: product.name, price: product.price, qty: 1 });

      updateCartUI();
    }

    if (addToCartBtn) {
      addToCartBtn.addEventListener('click', () => {
        if (!currentProduct) return;
        addToCart(currentProduct.id);
        closeProductModal();
      });
    }

    function openCartModal() {
      if (cartModal) cartModal.classList.add('active');
      redrawCartModal();
    }

    function redrawCartModal() {
      if (!cartList) return;
      cartList.innerHTML = '';
      if (!cart.length) {
        cartList.innerHTML = '<div class="cart-empty">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
        if (cartTotalEl) {
          cartTotalEl.innerHTML = '';
        }
        // –µ—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–º–æ–∫–æ–¥
        appliedPromo = null;
        if (promoInput) promoInput.value = '';
        if (promoMessage) promoMessage.textContent = '';
        return;
      }
      let baseTotal = 0;
      cart.forEach(item => {
        baseTotal += item.price * item.qty;
        const row = document.createElement('div');
        row.className = 'cart-item';
        row.innerHTML = `
          <div class="cart-item-left">${item.name}</div>
          <div class="cart-item-controls">
            <button class="qty-btn" data-id="${item.id}" data-action="minus">-</button>
            <span class="qty-text">${item.qty}</span>
            <button class="qty-btn" data-id="${item.id}" data-action="plus">+</button>
          </div>
        `;
        cartList.appendChild(row);
      });
      // —Å—á–∏—Ç–∞–µ–º —Å–∫–∏–¥–∫—É –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É
      let discount = 0;
      if (appliedPromo && PROMO_CODES[appliedPromo]) {
        discount = Math.round(baseTotal * PROMO_CODES[appliedPromo]);
      }
      const finalTotal = baseTotal - discount;
      if (cartTotalEl) {
        cartTotalEl.innerHTML = `
          <div class="cart-total-line">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤: ${baseTotal} ‚ÇΩ</div>
          ${discount
            ? `<div class="cart-total-line cart-total-discount">–°–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É: ‚àí${discount} ‚ÇΩ</div>`
            : ''
          }
          <div class="cart-total-line cart-total-final">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: ${finalTotal} ‚ÇΩ</div>
        `;
      }
      cartList.querySelectorAll('.qty-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const action = btn.getAttribute('data-action');
          changeQty(id, action);
        });
      });
    }

    if (applyPromoBtn) {
      applyPromoBtn.addEventListener('click', () => {
        if (!promoInput) return;
        const code = promoInput.value.trim().toUpperCase();
        if (!code) {
          appliedPromo = null;
          if (promoMessage) promoMessage.textContent = '–ü—Ä–æ–º–æ–∫–æ–¥ –æ—á–∏—â–µ–Ω';
          redrawCartModal();
          return;
        }
        if (PROMO_CODES[code]) {
          appliedPromo = code;
          if (promoMessage) {
            const percent = Math.round(PROMO_CODES[code] * 100);
            promoMessage.textContent = `–ü—Ä–æ–º–æ–∫–æ–¥ ¬´${code}¬ª –ø—Ä–∏–º–µ–Ω—ë–Ω: —Å–∫–∏–¥–∫–∞ ${percent}%`;
          }
        } else {
          appliedPromo = null;
          if (promoMessage) {
            promoMessage.textContent = '–¢–∞–∫–æ–π –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω';
          }
        }
        redrawCartModal();
      });
    }

    function changeQty(id, action) {
      const item = getCartItem(id);
      if (!item) return;

      if (action === 'plus') {
        item.qty += 1;
      } else if (action === 'minus') {
        item.qty -= 1;
        if (item.qty <= 0) {
          cart = cart.filter(i => i.id !== id);
        }
      }

      updateCartUI();
      redrawCartModal();
    }

    if (cartButton) {
      cartButton.addEventListener('click', openCartModal);
    }
    if (goToCartBtn) {
      goToCartBtn.addEventListener('click', openCartModal);
    }
    if (closeCartBtn) {
      closeCartBtn.addEventListener('click', () => {
        if (cartModal) cartModal.classList.remove('active');
      });
    }

    // ====== –ü–†–û–§–ò–õ–¨ ======
    if (profileBtn) {
      profileBtn.addEventListener('click', () => {
        if (profileModal) profileModal.classList.add('active');
        const data = JSON.parse(localStorage.getItem('profileData') || '{}');
        if (profileForm) {
          profileForm.surname.value = data.surname || '';
          profileForm.name.value = data.name || '';
          profileForm.patronymic.value = data.patronymic || '';
          profileForm.email.value = data.email || '';
          profileForm.country.value = data.country || '';
          profileForm.region.value = data.region || '';
          profileForm.city.value = data.city || '';
        }
      });
    }

    if (closeProfileBtn) {
      closeProfileBtn.addEventListener('click', () => {
        if (profileModal) profileModal.classList.remove('active');
      });
    }

    if (profileForm) {
      profileForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = {
          surname: this.surname.value,
          name: this.name.value,
          patronymic: this.patronymic.value,
          email: this.email.value,
          country: this.country.value,
          region: this.region.value,
          city: this.city.value
        };
        localStorage.setItem('profileData', JSON.stringify(formData));
        alert('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
        if (profileModal) profileModal.classList.remove('active');
      });
    }

    // ====== –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ò –û–¢–ü–†–ê–í–ö–ê –ó–ê–ö–ê–ó–ê –í TG ======
    if (checkoutBtn) {
      checkoutBtn.addEventListener('click', () => {
        if (!cart.length) return;
        if (confirmBackdrop) confirmBackdrop.classList.add('active');
      });
    }

    if (confirmCancel) {
      confirmCancel.addEventListener('click', () => {
        if (confirmBackdrop) confirmBackdrop.classList.remove('active');
      });
    }

    if (confirmOk) {
      confirmOk.addEventListener('click', () => {
        if (confirmBackdrop) confirmBackdrop.classList.remove('active');
        sendOrderToBot();
      });
    }

    function sendOrderToBot() {
    if (!cart.length) return;
  
    let baseTotal = 0;
    const itemsForSend = cart.map(item => {
      baseTotal += item.price * item.qty;
      return {
        id: item.id,
        name: item.name,
        price: item.price,
        qty: item.qty
      };
    });
  
    // –°—á–∏—Ç–∞–µ–º —Å–∫–∏–¥–∫—É –∏ –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É (–ø–æ–≤—Ç–æ—Ä—è–µ–º –ª–æ–≥–∏–∫—É –∏–∑ redrawCartModal)
    let discount = 0;
    let finalTotal = baseTotal;
    let promoCode = null;
  
    if (appliedPromo && PROMO_CODES[appliedPromo]) {
      promoCode = appliedPromo;
      discount = Math.round(baseTotal * PROMO_CODES[appliedPromo]);
      finalTotal = baseTotal - discount;
    }
  
    const payload = {
      items: itemsForSend,
      baseTotal: baseTotal,          // —Å—É–º–º–∞ –±–µ–∑ —Å–∫–∏–¥–∫–∏
      discount: discount,            // —Å—É–º–º–∞ —Å–∫–∏–¥–∫–∏
      finalTotal: finalTotal,        // –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ (—Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º)
      promoCode: promoCode           // —Å–∞–º –ø—Ä–æ–º–æ–∫–æ–¥ (null –µ—Å–ª–∏ –Ω–µ –±—ã–ª –ø—Ä–∏–º–µ–Ω—ë–Ω)
    };
  
    if (tg && typeof tg.sendData === 'function') {
      tg.sendData(JSON.stringify(payload));
    }
  }

    // –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    updateCartUI();
  </script>
</body>
</html>








